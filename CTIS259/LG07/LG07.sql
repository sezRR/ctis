-- CREATING TABLES
/*
CREATE TABLE STUDENTS (
    STID NUMBER(3) PRIMARY KEY,
    STNAME VARCHAR2(10) NOT NULL,
    STSURNAME VARCHAR2(20) NOT NULL,
    STADDRESS VARCHAR2(15)
);

CREATE TABLE BOOKS (
    ISBN VARCHAR2(10) PRIMARY KEY,
    TITLE VARCHAR2(30) NOT NULL,
    STATUS CHAR(1) CHECK (STATUS IN ('A', 'N'))
);

CREATE TABLE AUTHORS (
    AID NUMBER(3) PRIMARY KEY,
    ANAME VARCHAR2(10),
    ASURNAME VARCHAR2(20),
    COUNTRY VARCHAR2(10)
);

CREATE TABLE BOOKAUT (
    ISBN VARCHAR2(10),
    AUID NUMBER(3),
    CONSTRAINT BOOKAUT_PK PRIMARY KEY (ISBN, AUID),
    CONSTRAINT BOOKAUT_FK1 FOREIGN KEY (ISBN)
        REFERENCES BOOKS(ISBN)
        ON DELETE CASCADE,
    CONSTRAINT BOOKAUT_FK2 FOREIGN KEY (AUID)
        REFERENCES AUTHORS(AID)
        ON DELETE CASCADE
);

CREATE TABLE BORROWING (
    STUID NUMBER(3),
    BISBN VARCHAR2(10),
    BORROWDATE DATE DEFAULT SYSDATE,
    RETURNDATE DATE,
    DUEDATE DATE,
    PUNISHMENT NUMBER(10, 2) DEFAULT 0,
    CONSTRAINT BORROWING_PK PRIMARY KEY (STUID, BISBN, BORROWDATE),
    CONSTRAINT BORROWING_FK1 FOREIGN KEY (STUID)
        REFERENCES STUDENTS(STID)
        ON DELETE CASCADE,
    CONSTRAINT BORROWING_FK2 FOREIGN KEY (BISBN)
        REFERENCES BOOKS(ISBN)
        ON DELETE CASCADE
);
*/

-- DATA INSERTION

-- STUDENTS TABLE
/*
INSERT INTO STUDENTS (STID, STNAME, STSURNAME, STADDRESS) VALUES (111, 'ALI', 'OKUR', 'ANKARA');
INSERT INTO STUDENTS (STID, STNAME, STSURNAME, STADDRESS) VALUES (222, 'SEVINC', 'ER', 'IZMIR');
INSERT INTO STUDENTS (STID, STNAME, STSURNAME, STADDRESS) VALUES (333, 'MESUT', 'ERSOY', 'ANKARA');
INSERT INTO STUDENTS (STID, STNAME, STSURNAME, STADDRESS) VALUES (444, 'VELI', 'SURER', 'ISTANBUL');
INSERT INTO STUDENTS (STID, STNAME, STSURNAME, STADDRESS) VALUES (555, 'AYSE', 'GEZER', 'ISTANBUL');
*/

-- AUTHORS TABLE
/*
INSERT INTO AUTHORS (AID, ANAME, ASURNAME, COUNTRY) VALUES ('121', 'JERI R.', 'HANLY', 'USA');
INSERT INTO AUTHORS (AID, ANAME, ASURNAME, COUNTRY) VALUES ('122', 'ELLIOT B.', 'KOFFMAN', 'USA');
INSERT INTO AUTHORS (AID, ANAME, ASURNAME, COUNTRY) VALUES ('211', 'RICK', 'DECKER', 'GERMANY');
INSERT INTO AUTHORS (AID, ANAME, ASURNAME, COUNTRY) VALUES ('212', 'STUART', 'HIRSHFIELD', 'GERMANY');
INSERT INTO AUTHORS (AID, ANAME, ASURNAME, COUNTRY) VALUES ('311', 'GARY J.', 'BRONSON', 'USA');
INSERT INTO AUTHORS (AID, ANAME, ASURNAME, COUNTRY) VALUES ('411', 'ANDREW', 'DUTHIE', 'USA');
INSERT INTO AUTHORS (AID, ANAME, ASURNAME, COUNTRY) VALUES ('512', 'ROBERT', 'SEDGEWICK', 'ENGLAND');
*/

-- BOOKS TABLE
/*
INSERT INTO BOOKS (ISBN, TITLE, STATUS) VALUES ('0-201-20-8', 'Problem Solving in C', 'A');
INSERT INTO BOOKS (ISBN, TITLE, STATUS) VALUES ('0-501-70-6', 'Programming in Java', 'N');
INSERT INTO BOOKS (ISBN, TITLE, STATUS) VALUES ('4-258-60-7', 'DBMS', 'A');
INSERT INTO BOOKS (ISBN, TITLE, STATUS) VALUES ('0-201-00-6', 'Visual Basic', 'A');
INSERT INTO BOOKS (ISBN, TITLE, STATUS) VALUES ('5-401-80-5', 'ASP', 'A');
INSERT INTO BOOKS (ISBN, TITLE, STATUS) VALUES ('6-201-50-9', 'Algorithm', 'A');
INSERT INTO BOOKS (ISBN, TITLE, STATUS) VALUES ('4-580-20-5', 'Object Oriented Programming', 'N');
*/

-- BORROWING TABLE
/*
INSERT INTO BORROWING (STUID, BISBN, BORROWDATE, DUEDATE) 
VALUES ('111', '0-501-70-6', TO_DATE('07/12/2024', 'DD/MM/YYYY'), TO_DATE('22/12/2024', 'DD/MM/YYYY'));

INSERT INTO BORROWING (STUID, BISBN, BORROWDATE, RETURNDATE, DUEDATE) 
VALUES (111, '5-401-80-5', TO_DATE('04/10/2024', 'DD/MM/YYYY'), TO_DATE('08/10/2024', 'DD/MM/YYYY'),TO_DATE('19/10/2024', 'DD/MM/YYYY'));

INSERT INTO BORROWING (STUID, BISBN, BORROWDATE, RETURNDATE, DUEDATE) 
VALUES (111, '5-401-80-5', TO_DATE('08/11/2024', 'DD/MM/YYYY'), TO_DATE('28/11/2024', 'DD/MM/YYYY'),TO_DATE('23/11/2024', 'DD/MM/YYYY'));

INSERT INTO BORROWING (STUID, BISBN, BORROWDATE, RETURNDATE, DUEDATE) 
VALUES (222, '5-401-80-5', TO_DATE('29/10/2024', 'DD/MM/YYYY'), TO_DATE('1/12/2024', 'DD/MM/YYYY'),TO_DATE('14/10/2024', 'DD/MM/YYYY'));

INSERT INTO BORROWING (STUID, BISBN, BORROWDATE, RETURNDATE, DUEDATE)
VALUES ('333', '6-201-50-9', TO_DATE('27/09/2024', 'DD/MM/YYYY'), TO_DATE('14/10/2024', 'DD/MM/YYYY'), TO_DATE('12/10/2024', 'DD/MM/YYYY'));

INSERT INTO BORROWING (STUID, BISBN, BORROWDATE, RETURNDATE, DUEDATE) 
VALUES ('444', '4-580-20-5', TO_DATE('14/09/2024', 'DD/MM/YYYY'), TO_DATE('05/10/2024', 'DD/MM/YYYY'), TO_DATE('29/09/2024', 'DD/MM/YYYY'));

INSERT INTO BORROWING (STUID, BISBN, BORROWDATE, RETURNDATE, DUEDATE) 
VALUES ('444', '6-201-50-9', TO_DATE('05/11/2024', 'DD/MM/YYYY'), TO_DATE('29/11/2024', 'DD/MM/YYYY'), TO_DATE('20/11/2024', 'DD/MM/YYYY'));

INSERT INTO BORROWING (STUID, BISBN, BORROWDATE, DUEDATE)
VALUES ('333', '4-580-20-5', TO_DATE('09/12/2024', 'DD/MM/YYYY'), TO_DATE('24/12/2024', 'DD/MM/YYYY'));
*/

-- BOOKAUT TABLE
/*
INSERT INTO BOOKAUT(ISBN, AUID) VALUES ('0-201-20-8', 121);
INSERT INTO BOOKAUT(ISBN, AUID) VALUES ('0-201-20-8', 122);
INSERT INTO BOOKAUT(ISBN, AUID) VALUES ('0-501-70-6', 211);
INSERT INTO BOOKAUT(ISBN, AUID) VALUES ('0-501-70-6', 212);
INSERT INTO BOOKAUT(ISBN, AUID) VALUES ('4-258-60-7', 512);
INSERT INTO BOOKAUT(ISBN, AUID) VALUES ('0-201-00-6', 512);
INSERT INTO BOOKAUT(ISBN, AUID) VALUES ('5-401-80-5', 411);
INSERT INTO BOOKAUT(ISBN, AUID) VALUES ('6-201-50-9', 311);
INSERT INTO BOOKAUT(ISBN, AUID) VALUES ('4-580-20-5', 311);
INSERT INTO BOOKAUT(ISBN, AUID) VALUES ('4-580-20-5', 121);
*/

-- END OF THE DATA INSERTION
/*
COMMIT;
*/

-- QUERIES

-- Q1
SELECT STUID, TITLE, BORROWDATE, RETURNDATE FROM STUDENTS, BORROWING, BOOKS
WHERE STUID = STID AND BISBN = ISBN AND STUID = &STUID_INP;

-- Q2
SELECT ISBN, TITLE, STNAME, STSURNAME, BORROWDATE, RETURNDATE FROM STUDENTS, BOOKS, BORROWING
WHERE STUID = STID AND BISBN = ISBN;

-- Q3
SELECT DISTINCT ANAME, ASURNAME FROM BORROWING BR, BOOKAUT BA, AUTHORS A
WHERE A.AID = BA.AUID AND BR.BISBN = BA.ISBN;

-- Q4
SELECT TITLE FROM BOOKS
WHERE TITLE LIKE '%Programming%';

-- Q5
SELECT STNAME, STSURNAME FROM STUDENTS
WHERE STNAME LIKE 'A%';

-- Q6
SELECT DISTINCT STNAME, STSURNAME FROM STUDENTS, BORROWING, BOOKAUT, AUTHORS
WHERE STID = STUID AND BISBN = ISBN AND AUID = AID AND COUNTRY = 'USA';

-- Q7
SELECT STUID, BISBN, BORROWDATE, RETURNDATE, DUEDATE FROM BORROWING
WHERE RETURNDATE > DUEDATE;

-- Q8
SELECT STNAME, STSURNAME, TITLE FROM STUDENTS, BORROWING, BOOKS
WHERE STID = STUID AND BISBN = ISBN AND RETURNDATE IS NULL;

-- Q9
SELECT ANAME, ASURNAME FROM AUTHORS
WHERE COUNTRY =  'GERMANY'
ORDER BY ANAME ASC;

-- Q10
SELECT DISTINCT STNAME, STSURNAME FROM STUDENTS, BORROWING
WHERE STID = STUID AND BISBN IN ('4-580-20-5', '6-201-50-9');

-- Q11
SELECT TITLE, ANAME, ASURNAME FROM BOOKS B, AUTHORS A, BOOKAUT BA
WHERE B.ISBN = BA.ISBN AND A.AID =  BA.AUID
ORDER BY TITLE ASC;

-- Q12
SELECT STUID, BISBN, (RETURNDATE - BORROWDATE) DAYS_BORROWED FROM BORROWING
WHERE RETURNDATE IS NOT NULL;

-- Q13
SELECT STNAME, STSURNAME, TITLE, BORROWDATE FROM STUDENTS, BOOKS, BORROWING
WHERE STID = STUID AND BISBN = ISBN AND BORROWDATE BETWEEN TO_DATE('&start_date', 'DD-MM-YY') AND TO_DATE('&end_date', 'DD-MM-YY');







